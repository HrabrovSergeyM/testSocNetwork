{"version":3,"sources":["pages/Chat/ChatPage.tsx"],"names":["Chat","dispatch","useDispatch","useEffect","startMessagesListening","stopMessagesListening","Messages","AddMessageFormChat","messages","useSelector","state","chat","messagesAnchorRef","useRef","useState","isAutoScroll","setIsAutoScroll","current","scrollIntoView","behavior","style","height","overflowY","onScroll","e","element","currentTarget","Math","abs","scrollHeight","scrollTop","clientHeight","map","m","Message","key","id","message","ref","React","memo","src","photo","width","userName","setMessage","status","onChange","value","disabled","onClick","sendMessage","ChatPage"],"mappings":"kJAqBMA,EAAiB,WACrB,IAAMC,EAAWC,cASjB,OAPAC,qBAAU,WAER,OADAF,EAASG,eACF,WACLH,EAASI,kBAEV,IAGD,6BACE,kBAACC,EAAD,MACA,kBAACC,EAAD,QAKAD,EAAyB,WAC7B,IAAME,EAAWC,aAAY,SAACC,GAAD,OAAyBA,EAAMC,KAAKH,YAC3DI,EAAoBC,iBAAuB,MAFd,EAGKC,oBAAS,GAHd,mBAG5BC,EAH4B,KAGdC,EAHc,KAwBnC,OANAb,qBAAU,WACW,IAAD,EAAdY,IACF,UAAAH,EAAkBK,eAAlB,SAA2BC,eAAe,CAAEC,SAAU,cAEvD,CAACX,IAGF,yBACEY,MAAO,CAAEC,OAAQ,QAASC,UAAW,QACrCC,SAtBkB,SAACC,GACrB,IAAMC,EAAUD,EAAEE,cAEhBC,KAAKC,IACHH,EAAQI,aAAeJ,EAAQK,UAAYL,EAAQM,cACjD,KAEHhB,GAAgBC,GAAgB,GAEjCD,GAAgBC,GAAgB,KAe/BR,EAASwB,KAAI,SAACC,GAAD,OACZ,kBAACC,EAAD,CAASC,IAAKF,EAAEG,GAAIC,QAASJ,OAE/B,yBAAKK,IAAK1B,MAKVsB,EAAqDK,IAAMC,MAC/D,YAAkB,IAAfH,EAAc,EAAdA,QACD,OACE,6BACE,yBAAKI,IAAKJ,EAAQK,MAAOtB,MAAO,CAAEuB,MAAO,UAAa,IACtD,2BAAIN,EAAQO,UACZ,6BACCP,EAAQA,QACT,iCAMF9B,EAAmC,WAAO,IAAD,EACfO,mBAAS,IADM,mBACtCuB,EADsC,KAC7BQ,EAD6B,KAGvC5C,EAAWC,cACX4C,EAASrC,aAAY,SAACC,GAAD,OAAyBA,EAAMC,KAAKmC,UAU/D,OACE,6BACE,6BACE,8BACEC,SAAU,SAACvB,GAAD,OAAOqB,EAAWrB,EAAEE,cAAcsB,QAC5CA,MAAOX,KAGX,6BACE,4BAAQY,SAAqB,UAAXH,EAAoBI,QAjBjB,WACpBb,IAGLpC,EAASkD,YAAYd,IACrBQ,EAAW,OAYP,WAQOO,UA5GY,WACzB,OACE,6BACE,kBAACpD,EAAD","file":"static/js/6.59b43390.chunk.js","sourcesContent":["import React from \"react\";\r\nimport { useRef } from \"react\";\r\nimport { useState } from \"react\";\r\nimport { useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { ChatMessageAPIType } from \"../../api/chatApi\";\r\nimport {\r\n  sendMessage,\r\n  startMessagesListening,\r\n  stopMessagesListening,\r\n} from \"../../redux/chatReducer\";\r\nimport { AppStateType } from \"../../redux/reduxStore\";\r\n\r\nconst ChatPage: React.FC = () => {\r\n  return (\r\n    <div>\r\n      <Chat />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Chat: React.FC = () => {\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    dispatch(startMessagesListening());\r\n    return () => {\r\n      dispatch(stopMessagesListening());\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <Messages />\r\n      <AddMessageFormChat />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Messages: React.FC<{}> = () => {\r\n  const messages = useSelector((state: AppStateType) => state.chat.messages);\r\n  const messagesAnchorRef = useRef<HTMLDivElement>(null);\r\n  const [isAutoScroll, setIsAutoScroll] = useState(true);\r\n\r\n  const scrollHandler = (e: React.UIEvent<HTMLDivElement, UIEvent>) => {\r\n    const element = e.currentTarget;\r\n    if (\r\n      Math.abs(\r\n        element.scrollHeight - element.scrollTop - element.clientHeight\r\n      ) < 300\r\n    ) {\r\n      !isAutoScroll && setIsAutoScroll(true);\r\n    } else {\r\n      isAutoScroll && setIsAutoScroll(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isAutoScroll) {\r\n      messagesAnchorRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    }\r\n  }, [messages]);\r\n\r\n  return (\r\n    <div\r\n      style={{ height: \"400px\", overflowY: \"auto\" }}\r\n      onScroll={scrollHandler}\r\n    >\r\n      {messages.map((m) => (\r\n        <Message key={m.id} message={m} />\r\n      ))}\r\n      <div ref={messagesAnchorRef}></div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Message: React.FC<{ message: ChatMessageAPIType }> = React.memo(\r\n  ({ message }) => {\r\n    return (\r\n      <div>\r\n        <img src={message.photo} style={{ width: \"30px\" }} />{\" \"}\r\n        <b>{message.userName}</b>\r\n        <br />\r\n        {message.message}\r\n        <hr />\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nconst AddMessageFormChat: React.FC<{}> = () => {\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  const dispatch = useDispatch();\r\n  const status = useSelector((state: AppStateType) => state.chat.status);\r\n\r\n  const sendMessageHandler = () => {\r\n    if (!message) {\r\n      return;\r\n    }\r\n    dispatch(sendMessage(message));\r\n    setMessage(\"\");\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <div>\r\n        <textarea\r\n          onChange={(e) => setMessage(e.currentTarget.value)}\r\n          value={message}\r\n        ></textarea>\r\n      </div>\r\n      <div>\r\n        <button disabled={status !== \"ready\"} onClick={sendMessageHandler}>\r\n          Send\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatPage;\r\n"],"sourceRoot":""}